---
title: "Linear Model"
author: "Yuqi Zhang"
date: "2024-05-17"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
aggregated_data <- read.csv("AggregatedData1.csv")
daily_data <- read.csv("Daily_AggregatedData1.csv")
```

```{r}
cluster1 <- aggregated_data[, -c(2,3,4,5,6)]
```

```{r}
library(dplyr)

cluster1_trans <- cluster1 %>%
  mutate(Cluster.1_lag1 = lag(Cluster.1, n = 1))

# Apply the non-linear transformations
cluster1_trans <- cluster1_trans %>%
  mutate(
    tod_poly1 = tod,
    tod_poly2 = tod^2,
    tod_poly3 = tod^3,
    tod_poly4 = tod^4,
    weekend_dummy = ifelse(weekend == "TRUE", 1, 0),
    toy_sin = sin(toy),
    toy_cos = cos(toy)
  )

```



```{r}
cluster1_trans <- na.omit(cluster1_trans)

# Fit the linear regression model
linear_model <- lm(Cluster.1 ~ Cluster.1_lag1 + temp + tod_poly1 + tod_poly2 + tod_poly3 + tod_poly4 + weekend_dummy + toy_sin + toy_cos, data = cluster1_trans)

# Display the summary of the model
summary(linear_model)
```


```{r}
library(caret)
library(dplyr)
# Split the data into training and testing sets
set.seed(123)  # For reproducibility
train_index <- createDataPartition(cluster1_trans$Cluster.1, p = 0.8, list = FALSE)
train_data <- cluster1_trans[train_index, ]
test_data <- cluster1_trans[-train_index, ]

# Fit the linear regression model on the training set
linear_model <- lm(Cluster.1 ~ Cluster.1_lag1 + temp + tod_poly1 + tod_poly2 + tod_poly3 + tod_poly4 + weekend_dummy + toy_sin + toy_cos, data = train_data)

# Make predictions on the testing set
test_data$predictions <- predict(linear_model, newdata = test_data)

# Calculate prediction error metrics
mae <- mean(abs(test_data$Cluster.1 - test_data$predictions))
mse <- mean((test_data$Cluster.1 - test_data$predictions)^2)
rmse <- sqrt(mse)

# Print the results
cat("Mean Absolute Error (MAE):", mae, "\n")
cat("Mean Squared Error (MSE):", mse, "\n")
cat("Root Mean Squared Error (RMSE):", rmse, "\n")

```


```{r}
# Plot predicted vs true values
ggplot(test_data, aes(x = Cluster.1, y = predictions)) +
  geom_point(color = 'blue', alpha = 0.5) +
  geom_abline(intercept = 0, slope = 1, color = 'red', linetype = "dashed") +
  labs(title = "Predicted vs True Values",
       x = "True Values",
       y = "Predicted Values") +
  theme_minimal()
```
```{r}
summary(linear_model)
```

